<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no">
    <meta name=format-detection content="telephone=no">
    <title>国庆私人飞机</title>
    <script src="./js/config.js"></script>
    <script src="js/jquery-2.1.4.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/nprogress@0.2.0/nprogress.css">
    <link rel="stylesheet" href="./css/pace-theme-big-counter.css">
    <link rel="stylesheet" href="./css/main.css">

    <script src="https://unpkg.com/nprogress@0.2.0/nprogress.js"></script> 
    <script src="js/pace.min.js"></script>

    <script type="text" id="myId">
        <br>
        <div class="splash card"><br>
            <p class="lead" style="text-align:center"></p>

            <div class="progress">
                <div class="barcontainer">
                    <div class="mybar" role="bar">
                        <img src="./img/jindutiao_3.png" >
                    </div>
                </div>
            </div>
        </div><br>
    </script>
    <!-- 分享 -->
    <script src=http://res.wx.qq.com/open/js/jweixin-1.2.0.js></script>
    <script type=text/javascript src=http://www.bjweifeng.cn/zimuWx/js/yundaoWxV2.0.js></script>
    <script>
        yundaoWx.share_title = "送你一架私人飞机";
        yundaoWx.share_desc = "一言九鼎，不信戳进来";
        yundaoWx.share_link = "http://h5.sjzzimu.com/baiduaircraft/index.html";
        yundaoWx.share_imgUrl = "http://h5.sjzzimu.com/baiduaircraft/img/min.png";
        yundaoWx.share();
    </script>
    <!-- 统计 -->
    
    <script>
        var _mtac = {};
        (function () {
            var mta = document.createElement("script");
            mta.src = "http://pingjs.qq.com/h5/stats.js?v2.0.2";
            mta.setAttribute("name", "MTAH5");
            mta.setAttribute("sid", "500530692");
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(mta, s);
        })();

    </script>

</head>
<style>
    .page {
        position: relative;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url("./img/beijing.png") 0 0;
        background-size: 100% 100%;
    }
    .select-container {
        position: fixed;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        z-index: 100;
        background: url("./img/mcbj.png") 0 0;
        display: none;
    }
     .go {
        position: absolute;
        background: url("./img/anniu_4.png") 0 0;
        background-size: 100% 100%;
        bottom: 2rem;
        right: 5%;
        width: 27%;
        height: 1.5rem;
    }
    .select {
        position: absolute;
        left: 5%;
        bottom: 5%;
        width: 90%;
        height: 83%;
        background-color: #f7f7f7;
        z-index: 100;
        background: url("./img/dikuang.png") 0 0;
        background-size: 100% 100%;
        padding-top: 12%;
        
    }
    .select .selected {
        color: #000;
    }
    .close {
        display: block;
        position: absolute;
        top: .2rem;
        right: .2rem;
        width:1.5rem;
        height: 1.5rem;
        background: url("./img/guanbi.png") 0 0;
        background-size: 100% 100%;
    }
    .item {
        width: 100%;
        height: 5%;
        font-size: .45rem;
        padding:0 5%;
        color: #717171;
        overflow: hidden;
        white-space: nowrap; text-overflow: ellipsis;
    }
    
    .item img {
        width: 100%;
    }
    .change_addr {
        bottom: 7rem;
        background: url("./img/xzjc.png") 0 0;
        background-size: 100% 100%;
    }
</style>
<body>
    <div class="main" style="visibility: hidden;">
        <div class="select-container">
            <div class="select">
                <span class="close"></span>
                <span class="selectaddr"></span>
            </div>
        </div>
        <div class="page-1">
            <div class="template">
                <img src="" alt="">
            </div>
            <!-- <div class="autograph_container" style="background: #fff">
                <canvas id="c4"></canvas>
            </div> -->
            <div class="input_container">
                <input type="text" value="" name="input" placeholder="请在这里输入姓名">
            </div>
            
            <div class="change_addr btn"></div>
            <div class="change_templage btn"></div>
            <div class="ok btn"></div>
        </div>

        <div class="page-2">
            <div class="photo" style=" border: 1px #eee solid;">
                <img src="" alt="" class="path" style="top:-2rem;">
            </div>
            <div class="save">
            </div>
            <div class="baidu">
            </div>
            <div class="search">
            </div>
            <div class="share_btn">
            </div>
            <div style="display: none">
                <!-- <canvas id="textrue" width="108" height="192" style="border:1px solid"></canvas> -->
                <canvas id="textrue" width="556" height="713" style="border:1px solid"></canvas>
            </div>
        </div>
        <div class="share">
        </div>
        <div class="page" style="z-index: 20">
            <div class="photo shareSrc" style=" border: 1px #eee solid;">
                <img src="" alt="" class="sharesrc" style="top:-2rem;">
            </div>
            <div class="baidu">
            </div>
            <div class="search">
            </div>
            <div class="go">
            </div>
        </div>
    </div>

</body>

<script>
    
    $(function () {
        var windowH = $(window).height()
        
        NProgress.configure({
            template: $('#myId').html(), // template是用来设置动画样式的属性
        });
        NProgress.start()
        // 加载完
        Pace.on('done', function () {
            Pace.stop()
            NProgress.done()
            $('.main').css('visibility', 'visible')
            $('.page-1').css('height', windowH)

        })

        var sharesrc = yundaoWx.getUrlParam('fromId')
        console.log(sharesrc)
        if (sharesrc == null) {
            $('.page').css('display', 'none')
        }
        $('.sharesrc').attr('src', sharesrc)
        $('.go').on('touchstart', function () {
            $('.page').css('display', 'none')
        })
        

        
        // 不同系统模板图片不同
        var u = navigator.userAgent, app = navigator.appVersion;
        var isAndroid = u.indexOf('Android') > -1 || u.indexOf('Linux') > -1; //android终端或者uc浏览器
        var isiOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端
        console.log('是否是Android：' + isAndroid);
        console.log('是否是iOS：' + isiOS);

        if (isiOS) {
            var template = [
                'img/1ios.png',
                'img/2ios.png',
                'img/3ios.png',
                'img/4ios.png',
            ]
            console.log('ios')
        } else if (isAndroid) {
            var template = [
                'img/1android.png',
                'img/2android.png',
                'img/3android.png',
                'img/4android.png',
            ]
            console.log('android')
        }
        const addr = [
            '巴黎 • Charles De Gaulle Airport',
            '北京 • 首都国际机场',
            '成都 • 双流国际机场',
            '广州 • 白云国际机场',
            '贵阳 • 龙洞堡机场',
            '哈尔 • 滨太平国际机场',
            '海口 • 美兰国际机场',
            '杭州 • 萧山国际机场',
            '巴西 • Rio De Janeiro Airport',
            '美国 • Los Angeles International Airport',
            '南京 • 禄口国际机场',
            '青岛 • 流亭机场',
            '厦门 • 高崎国际机场',
            '上海 • 虹桥国际机场',
            '深圳 • 宝安国际机场',
            '沈阳 • 桃仙国际机场',
            '石家庄 • 正定国际机场',
            '西安 • 咸阳国际机场',
            '澳大利亚 • Sydney Kingsford Smith International Airport',
            '重庆 • 江北国际机场',
        ]
        const canvasAddr = [
                '巴黎 • Charles De G....',
                '北京 • 首都国际机场',
                '成都 • 双流国际机场',
                '广州 • 白云国际机场',
                '贵阳 • 龙洞堡机场',
                '哈尔 • 滨太平国际机场',
                '海口 • 美兰国际机场',
                '杭州 • 萧山国际机场',
                '巴西 • Rio De Janei....',
                '美国 • Los Angeles ....',
                '南京 • 禄口国际机场',
                '青岛 • 流亭机场',
                '厦门 • 高崎国际机场',
                '上海 • 虹桥国际机场',
                '深圳 • 宝安国际机场',
                '沈阳 • 桃仙国际机场',
                '石家庄 • 正定国际机场',
                '西安 • 咸阳国际机场',
                '澳大利亚 • Sydney Ki...',
                '重庆 • 江北国际机场',
            ]
        // 添加飞机场地址
        let selectAddr = ''
        
        for (let i = 0; i < 20; i++) {
            let classIndex = parseInt(`${i}-item`)
            let className = `.${i}-item`
            // $('.selectaddr').before("<div  class=" + `${i}-item` +"><img src='./img/" + `${i+1}` +".png'></div>")
            $('.selectaddr').before("<div  class=" + `${i}-item` +  ">" + addr[i] + "</div>")
            $(className).on('touchstart', function () {
                $(className).addClass('selected')
                selectAddr = canvasAddr[classIndex]
                console.log(selectAddr)
                $('.select-container').fadeOut()
            })
        }    
        $('.select > div').addClass('item')
        $('.change_addr').on('touchstart', function () {
            $('.select-container').fadeIn()
             $('.select > div').removeClass('selected')
        })
        $('.close').on('touchstart', function () {
            $('.select-container').fadeOut()
        })
        // 设置图片模板
        let index = 0
        $('.input_container ').css('display', 'display')
        $('.button_clear').css('display', 'none')

        $('.template > img').attr('src', template[0])

        $('.change_templage').click(function () {
            index++
            // console.log(index)
            if (index == template.length) {
                index = 0
            }
            $('.template > img').attr('src', template[index])
        
        })
        let dataURL = ''
        var ctx = document.getElementById('textrue').getContext('2d');
        // 点击生成签名
        $('.ok').on('touchstart', function () {
            if (!selectAddr) {
                alert('请选择机场!')
                return
            }
            $('.page-1 ').css('display', 'none')
            $('.page-2 ').css('display', 'block')

            // 合成背景图
            var imgbg = new Image()
            imgbg.src = template[index]
            imgbg.onload = function () {
            ctx.drawImage(imgbg, 0, 0, 556, 713)
            // 机场地址
            ctx.font = '40px 黑体';
            ctx.fillStyle = '#576B95';
            ctx.fillText(selectAddr, 30, 673);
            // 输入内容
            input()
            }
        })
        // 输入名字
        window.pagePath = null
        function input() {
            var inputName = $(" input[ name='input' ] ").val()
            if(index == 0 ) {
                ctx.font = '13px 黑体';
                ctx.fillStyle = '#415a69';
                ctx.fillText(inputName, 380, 126);
            }else if(index == 1) {
                ctx.font = '10px 黑体';
                ctx.fillStyle = '#d4d4d5'; 
                ctx.fillText(inputName, 416, 449);
            } else if (index == 2) {
                ctx.font = '13px 黑体';
                ctx.fillStyle = '#340101';
                ctx.fillText(inputName, 255, 340);
            }else {
                ctx.font = '13px 黑体';
                ctx.fillStyle = '#415a69';
                ctx.fillText(inputName, 403, 117);
            }

            var path = document.getElementById('textrue').toDataURL("image/jpeg", 1)
            
            $('.path').attr('src', path)

           $.post('http://h5.sjzzimu.com/weixinUpload/uploadImage.action', {
                base: path,
            }, function (response) {
                console.log(response)
                window.pagePath = response
                yundaoWx.share_title = "送你一架私人飞机";
                yundaoWx.share_desc = "一言九鼎，不信戳进来";
                yundaoWx.share_link = "http://h5.sjzzimu.com/baiduaircraft/index.html?fromId=" + pagePath;
                yundaoWx.share_imgUrl = "http://h5.sjzzimu.com/baiduaircraft/img/min.png";
                yundaoWx.share();
            })

        }
        

        //分享
        $('.share_btn').on('touchstart', function () {
            $('.share').css('display', 'block')
        })
        $('.share').on('touchstart', function () {
            $('.share').css('display', 'none')
        })
        $('.search').on('touchstart', function () {
            $(window).attr('location', 'https://rc.mbd.baidu.com/ljf8wsa');
        })
        /*微信白条*/
        $('body').on('touchmove', function (event) {
            event.preventDefault();
        })
       
    })

</script>

</html>